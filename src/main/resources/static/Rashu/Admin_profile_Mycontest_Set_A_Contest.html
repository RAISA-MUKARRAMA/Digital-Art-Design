<html lang="en">
    <head>
        <title>
            Set A Contest
        </title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="Admin_profile_body_background.css">
        <link rel="stylesheet" href="Admin_profile_menu-bar.css">
        <link rel="stylesheet" href="Admin_profile_main-content.css">
        <link rel="stylesheet" href="Admin_profile_form.css">
        <link rel="stylesheet" href="Admin_profile_display_table.css">
        <link rel="stylesheet" href="Admin_profile_footer.css">
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">


    </head>
    <body>
        <header>
            <div class="backgrounding">
                <div class="menubar">
                    <img src="design_logo_02.jpg" class="logo">
                    <ul style="color:white; padding: 5px;" >

                        <li><i class="fas fa-user-circle" style="color: white;"></i><span style="color:white; padding: 5px" id="adminName"> </span></li>
                    </ul>
                </div>
            </div>
         </header>

    <main class="content_main">
        <div class="menu-bar">
        <ul>
            <li><a href="/home"><i class="fa fa-home "></i> Home</a></li>
            <li><a href="Admin_profile_my_profile.html"><i class="fa fa-user "></i> My profile</a></li>
            <li><a href="Admin_profile_Designs.html"><i class="fas fa-list-ul "></i> Designs</a>

            </li>
            
            <li><a href="Admin_profile_Designers.html"><i class="fa fa-users"></i> Designers</a></li>
            <li><a href="Admin_profile_Users.html"><i class="fa fa-users"></i> Users</a></li>
            <li><a href="Admin_profile_Users.html"><i class="fa fa-users"></i> Admins</a></li>
            <li class="active" ><a href="#"><i class="fas fa-trophy contest-icon "></i> My contest</a>
                <div class="sub-menu-2">
                    <ul>
                        <li><a href="Admin_profile_Mycontest_contest_request.html">Contest Requests</a></li>
                        <li><a href="Admin_profile_Mycontest_previous_contest.html">Previous Contest</a></li>
                        <li><a >Set A Contest</a></li>
                    </ul>
                </div>
            </li>
            <li><a href="Admin_profile_Inbox.html"><i class="fas fa-inbox inbox-icon"></i> Inbox</a></li>
            <li ><a href="#"><i class="fas fa-bullhorn announcement-icon "></i> Announcements</a>
                <div class="sub-menu-2">
                    <ul>
                        <li><a href="Admin_profile_Announcement_previous_announcement.html">Previous Announcement</a></li>
                        <li><a href="Admin_profile_Announcement_Set_an__announcement.html">Set An Announcement</a></li>
                    </ul>
                </div>
            </li>
            
            <li><a href="#"><i class="fas fa-cog profile-settings-icon "></i> Profile Setting</a>
                <div class="sub-menu-2">
                    <ul>
                        <li><a href="Admin_profile_Edit_Profile_update_details.html">Update Details</a></li>
                        <li><a href="Admin_profile_Edit_Profile_Change_password.html">Change Password</a></li>

                    </ul>
                </div>
            </li>
            <li onclick="logout()"><a href="" ><i class="fas fa-sign-out-alt"></i> Logout</a></li>

        </ul>
        </div>

        <div class="container" >
            <h2 style="color:#967d00;text-align: center;">Create New Contest</h2>
            <form id="contestForm" action="javascript:void(0);" method="post">
                <div class="form-group">
                    <label for="contestTitle">Title</label>
                    <input type="text" id="contestTitle" name="contestTitle" placeholder="Must be less than 70 character"required>
                </div>
                <div class="form-group">
                    <label for="contestsUser">User ID</label>
                    <input type="number" id="contestsUser" name="contestsUser" required>
                </div>
                <div class="form-group">
                    <label for="contestsDate">Starting Date</label>
                    <input type="date" id="contestsDate" name="contestsDate" required>
                </div>
                <div class="form-group">
                    <label for="contestLDate">Last Date</label>
                    <input type="date" id="contestLDate" name="contestLDate" required>
                </div>
                <div class="form-group">
                    <label for="contestDescription">Description</label>
                    <textarea id="contestDescription" name="contestDescription" rows="4" placeholder="Must be less than 1000 character" required></textarea>
                </div>
                <div class="form-group">
                    <label for="maxSubmissions">Max Submissions</label>
                    <input type="number" id="maxSubmissions" name="maxSubmissions" min="1" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Confirmation Password</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn" onclick="validateAndSubmit()">Create Contest</button>
                </div>
            </form>
            <div class="popup" id="successPopup">
                <img src="tick01.png">
                <h2 style="color: #4CAF50">Success</h2>
                <p>Your Contest has been set successfully.</p>
                <button type="button" onclick="closeSuccessPopup()">OK</button>
            </div>
            <div class="popup" id="errorPopup">
                <h2 style="color: #b30021">Error</h2>
                <p id="errorText"></p>
                <button type="button" onclick="closeErrorPopup()">OK</button>
            </div>
        </div>

    </main>



        <footer class="footer">
            <div class="container_ftr">
                <div class="row">
                    <div class="footer-col">
                        <ul>
                            <li>&copy; COPYRIGHT Reserved by</li>
                            <li>Digital Art Design </li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <ul>
                        <div class="contact">
                            <li>Contact Information:</li>
                            <li>Address: Chittagong ,Bangladesh</li>
                            <li>Phone: <a href="tel:+15551234567">(555) 123-4567</a></li>
                            <li>Email: <a href="mailto:info@example.com">info@example.com</a></li>
                        </div>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>Help</h4>
                        <ul>
                            <li><a href="Admin_profile_About_Us.html">about us</a></li>
                            <li><a href="Admin_profile_Our_Services.html">our services</a></li>
                            <li><a href="Admin_profile_FAQ.html">FAQ</a></li>
                        </ul>
                    </div>
                    <div class="footer-col">
                        <h4>follow us</h4>
                        <div class="social-links">
                            <a ><i class="fab fa-facebook-f"></i></a>
                            <a ><i class="fab fa-twitter"></i></a>
                            <a ><i class="fab fa-instagram"></i></a>
                            <a ><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                </div>
            </div>
       </footer>

        <script>
            // Function to logout and redirect to home page
            function logout() {
                sessionStorage.removeItem("Admin_id"); // Remove the Admin_id from session storage
                window.location.href = "/home";
            }
            function checkAdminId() {
                let id = sessionStorage.getItem("Admin_id");
                if (id === null) {
                    window.location.href = "/home";
                    return null; // Return null if Admin_id is null
                }
                return id; // Return Admin_id if it exists
            }
            let popup = document.getElementById("successPopup");
            let errorPopup = document.getElementById("errorPopup");
            let errorText = document.getElementById("errorText");

            const admin_nameContainer = document.getElementById("adminName");

            const Admin_Name = sessionStorage.getItem('Admin_Name');
            console.log(Admin_Name);
            admin_nameContainer.innerHTML=Admin_Name;
            let p=0;
            function openSuccessPopup() {
                popup.classList.add("open-popup");
            }

            function closeSuccessPopup() {
                p=1;
                popup.classList.remove("open-popup");
                location.reload();
            }

            function openErrorPopup() {
                if(p===1)
                    return;
                errorPopup.classList.add("open-popup");
            }

            function closeErrorPopup() {
                errorPopup.classList.remove("open-popup");
            }

            function validateAndSubmit() {
                const contestTitle = document.getElementById("contestTitle").value;
                const contestsDate = document.getElementById("contestsDate").value;
                const contestLDate = document.getElementById("contestLDate").value;
                const contestsUser = document.getElementById("contestsUser").value;
                const contestDescription = document.getElementById("contestDescription").value;
                const maxSubmissions = document.getElementById("maxSubmissions").value;
                const confirmPassword = document.getElementById("confirmPassword").value;


                const startDate = new Date(contestsDate);
                const lastDate = new Date(contestLDate);



                // Make a GET request to fetch user details


                if (!contestTitle || !contestsDate || !contestLDate || !contestDescription || !maxSubmissions || !confirmPassword ||!contestsUser) {
                    errorText.textContent = " Please fill in all required fields.";
                    openErrorPopup();
                } else if (startDate > lastDate) {
                    errorText.textContent = " Contest starting date cannot be after the last date.";
                    openErrorPopup();
                } else if( contestDescription.length > 1000) {
                    errorText.textContent = " Description should be less than 1000 characters.";
                    openErrorPopup();
                }else if (contestTitle.length > 70) {
                    errorText.textContent = " Contest Title should be less than 70 characters.";
                    openErrorPopup();
                }else{
                    const userId = contestsUser;
                    fetch(`/Rashu_users/one?userId=${userId}`)
                        .then(response => {
                            if (!response.ok) {
                                errorText.textContent = " Wrong User ID";
                                openErrorPopup();
                                throw new Error('Network response was not ok');
                            }
                            return response.json(); // Parse the JSON response
                        })
                        .then(user => {
                            // Handle the user data
                            console.log('User details:', user);
                            errorText.textContent = "";
                            submitForm();
                        })
                        .catch(error => {
                            console.error('There was a problem with the fetch operation:', error);
                        });

                }
            }

            function submitForm() {
                const contestTitle = document.getElementById("contestTitle").value;
                const contestsDate = document.getElementById("contestsDate").value;
                const contestLDate = document.getElementById("contestLDate").value;
                const contestsUser = document.getElementById("contestsUser").value;
                const contestDescription = document.getElementById("contestDescription").value;
                const maxSubmissions = document.getElementById("maxSubmissions").value;
                const confirmPassword = document.getElementById("confirmPassword").value;
                const id = sessionStorage.getItem("Admin_id");


                const startDate = new Date(contestsDate);
                const lastDate = new Date(contestLDate);

                const data = {
                    contestTitle,
                    contestsDate,
                    contestLDate,
                    contestsUser,
                    contestDescription,
                    maxSubmissions,
                    confirmPassword,
                    id,
                };

                fetch('/api/Rashu_setacontest', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                })
                    .then((response) => {
                        if (response.status === 200) {
                            return response.text();
                        } else {
                            return response.json().then((error) => Promise.reject(error.message));
                        }
                    })
                    .then((data)  => {
                        openSuccessPopup();
                    })
                    .catch((error) => {
                        errorText.textContent = "Error: " + error;
                        openErrorPopup();
                    });
            }

            // Check if Admin_id is null on page load
            document.addEventListener("DOMContentLoaded", function () {
                checkAdminId();
            });
            window.addEventListener("beforeunload", function(event) {
                const id = sessionStorage.getItem("Admin_id");
                if (id === null) {
                    sessionStorage.removeItem("Admin_id");
                }
            });
        </script>
    </body>
</html>