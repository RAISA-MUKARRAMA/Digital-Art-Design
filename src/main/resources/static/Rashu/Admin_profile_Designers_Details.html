<html lang="en">
<head>
    <title>
        Designer Details
    </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="Admin_profile_body_background.css">
    <link rel="stylesheet" href="Admin_profile_menu-bar.css">
    <link rel="stylesheet" href="Admin_profile_main-content.css">
    <link rel="stylesheet" href="Admin_profile_form.css">
    <link rel="stylesheet" href="Pagination.css">
    <link rel="stylesheet" href="Admin_profile_display_table.css">
    <link rel="stylesheet" href="Admin_profile_footer.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

    <style>

        .profile {
            text-align: center;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            width: 550px;
            margin: 5px auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            background-color: #f9f9f9;
            color:#333;
        }

        .profile p {
            font-size: 18px;
            margin: 10px 0;
        }
        .ID{
            color:#967d00;
            font-style:italic;
        }
        .profile p:first-child {
            font-weight: bold;
            color: #333;
        }
        .profile p:not(:first-child) {
            color: #555;
        }
        #category {

            max-width: 500px;
            padding: 8px;


            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;


            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;

            background-position: right 8px center;
            background-repeat: no-repeat;
        }


        #category option {
            font-size: 16px;
            background-color: #fff;
            max-width: 300px;
            color: #333;
        }

    </style>
</head>
<body>
<header>
    <div class="backgrounding">
        <div class="menubar">
            <img src="design_logo_02.jpg" class="logo">

            <ul style="color:white; padding: 5px;" >

                <li><i class="fas fa-user-circle" style="color: white;"></i><span style="color:white; padding: 5px" id="adminName"> </span></li>
            </ul>
        </div>
    </div>
</header>

<main class="content_main">
    <div class="menu-bar">
        <ul>
            <li><a href="/home"><i class="fa fa-home "></i> Home</a></li>
            <li><a href="Admin_profile_my_profile.html"><i class="fa fa-user "></i> My profile</a></li>
            <li><a href="Admin_profile_Designs.html"><i class="fas fa-list-ul "></i> Designs</a></li>


            <li class="active"><a ><i class="fa fa-users"></i> Designers</a></li>
            <li  ><a href="Admin_profile_Users.html"><i class="fa fa-users"></i> Users</a></li>
            <li ><a href="Admin_profile_Admins.html"><i class="fa fa-users"></i> Admins</a></li>
            <li><a href="#"><i class="fas fa-trophy contest-icon "></i> My contest</a>
                <div class="sub-menu-2">
                    <ul>
                        <li><a href="Admin_profile_Mycontest_contest_request.html">Contest Requests</a></li>
                        <li><a href="Admin_profile_Mycontest_previous_contest.html">Previous Contest</a></li>
                        <li><a href="Admin_profile_Mycontest_Set_A_Contest.html">Set A Contest</a></li>
                    </ul>
                </div>
            </li>
            <li><a href="Admin_profile_Inbox.html"><i class="fas fa-inbox inbox-icon"></i> Inbox</a></li>
            <li ><a href="#"><i class="fas fa-bullhorn announcement-icon "></i> Announcements</a>
                <div class="sub-menu-2">
                    <ul>
                        <li><a href="Admin_profile_Announcement_previous_announcement.html">Previous Announcement</a></li>
                        <li><a href="Admin_profile_Announcement_Set_an__announcement.html">Set An Announcement</a></li>
                    </ul>
                </div>
            </li>

            <li><a href="#"><i class="fas fa-cog profile-settings-icon "></i> Profile Setting</a>
                <div class="sub-menu-2">
                    <ul>
                        <li><a href="Admin_profile_Edit_Profile_update_details.html">Update Details</a></li>
                        <li><a href="Admin_profile_Edit_Profile_Change_password.html">Change Password</a></li>

                    </ul>
                </div>
            </li>
            <li onclick="logout()"><a href="" ><i class="fas fa-sign-out-alt"></i> Logout</a></li>

        </ul>
    </div>
    <div class="main-content">


        <h3>Designer Information</h3>
        <div class="profile" id="designerProfile">

        </div>
        <select id="category" name="category" required></select>
            <div id="designList">
                <h1>Design List</h1>
                <table>
                    <tr>
                        <th>Design Title</th>
                        <th>Description</th>
                        <th>Category</th>
                        <th>preview</th>
                    </tr>
                </table>
                <div id="pagination">
                    <button id="prevButton">Previous</button>
                    <button id="nextButton">Next</button>
                </div>
            </div>
        </div>

</main>

<footer class="footer">
    <div class="container_ftr">
        <div class="row">
            <div class="footer-col">
                <ul>
                    <li>&copy; COPYRIGHT Reserved by</li>
                    <li>Digital Art Design </li>
                </ul>
            </div>
            <div class="footer-col">
                <ul>
                    <div class="contact">
                        <li>Contact Information:</li>
                        <li>Address: Chittagong ,Bangladesh</li>
                        <li>Phone: <a href="tel:+15551234567">(555) 123-4567</a></li>
                        <li>Email: <a href="mailto:info@example.com">info@example.com</a></li>
                    </div>
                </ul>
            </div>
            <div class="footer-col">
                <h4>Help</h4>
                <ul>
                    <li><a href="Admin_profile_About_Us.html">about us</a></li>
                    <li><a href="Admin_profile_Our_Services.html">our services</a></li>
                    <li><a href="Admin_profile_FAQ.html">FAQ</a></li>
                </ul>
            </div>
            <div class="footer-col">
                <h4>follow us</h4>
                <div class="social-links">
                    <a ><i class="fab fa-facebook-f"></i></a>
                    <a ><i class="fab fa-twitter"></i></a>
                    <a ><i class="fab fa-instagram"></i></a>
                    <a ><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
    </div>
</footer>
<script>
    function logout() {
        sessionStorage.removeItem("Admin_id"); // Remove the Admin_id from session storage
        window.location.href = "/home";
    }
    function checkAdminId() {
        let id = sessionStorage.getItem("Admin_id");
        if (id === null) {
            window.location.href = "/home";
            return null; // Return null if Admin_id is null
        }
        return id; // Return Admin_id if it exists
    }

    window.addEventListener("beforeunload", function(event) {
        const id = sessionStorage.getItem("Admin_id");
        if (id === null) {
            sessionStorage.removeItem("Admin_id");
        }
    });
    document.addEventListener("DOMContentLoaded", function () {
        if(checkAdminId()===null)
            return;
        const id = sessionStorage.getItem("Admin_id");
        sessionStorage.setItem("Admin_id", id);
        const admin_nameContainer = document.getElementById("adminName");
        const designer_id = sessionStorage.getItem("designer_id");
        const Admin_Name = sessionStorage.getItem('Admin_Name');
        console.log(Admin_Name);
        admin_nameContainer.innerHTML = Admin_Name;

        const categorySelect = document.getElementById('category');

        categorySelect.addEventListener('change', function () {
            const selectedCategory = categorySelect.value;

            if (selectedCategory === 'All') {
                fetchDesignData(`/Rashu_designs/list/${designer_id}`);

            } else {
                const encodedCategory = encodeURIComponent(selectedCategory);
                fetchDesignData(`/Rashu_designs/list/designer-and-category/${designer_id}/${encodedCategory}`);
            }
        });

        fetch('/Rashu_designs/showlist')
            .then(response => response.json())
            .then(categories => {
                categorySelect.innerHTML = '';

                const defaultOption = document.createElement('option');
                defaultOption.value = 'All';
                defaultOption.text = 'All Designs';
                categorySelect.appendChild(defaultOption);

                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.ctgr_Title;
                    option.text = category.ctgr_Title;
                    categorySelect.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching categories:', error));

        const itemsPerPage = 9;
        let currentPage = 1;
        let designs;
        const designList = document.getElementById("designList");
        const table = designList.querySelector("table");

        function fetchDesignData(url) {
            console.log('Fetch URL:', url);

            fetch(url)
                .then(response => {
                    if (response.status === 200) {
                        return response.json();
                    } else if (response.status === 204) {

                        console.log('No content found for the specified category.');
                        return [];
                    } else {
                        throw new Error(`Unexpected response status: ${response.status}`);
                    }
                })
                .then(data => {
                    designs = data;
                    console.log("2");
                    displayDesigns(data, currentPage);
                })
                .catch(error => console.error('Error fetching design data:', error));
        }


        function displayDesigns(designs, page) {
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }

            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = page * itemsPerPage;
            if (designs.length === 0) {
                const noDesignsRow = table.insertRow();
                const noDesignsCell = noDesignsRow.insertCell(0);
                noDesignsCell.colSpan = 4;
                noDesignsCell.innerHTML = 'No designs found for the specified category.';
                return;
            }
            for (let i = startIndex; i < endIndex && i < designs.length; i++) {
                const design = designs[i];
                const row = table.insertRow();
                const cell1 = row.insertCell(0);
                const cell2 = row.insertCell(1);
                const cell3 = row.insertCell(2);
                const cell4 = row.insertCell(3);
                let ratings=design.rating;
                if(ratings === null)
                {   ratings=0; }
                console.log(design);
                //fas fa-thumbs-up
                const likes = `<p>${design.title}</p><br><i class="fas fa-heart" style="color :red; font-size: 20px"></i> ${ratings}`;


                console.log(design.title);

                cell1.innerHTML = likes;
                cell2.innerHTML = design.description;
                cell3.innerHTML = design.category.ctgr_Title;
                console.log('Type of design.content:', design.category.ctgr_Title);
                console.log('Length of design.content:', design.content.length);

                const previewImage = document.createElement("img");
                console.log("3  " + design.content);

                const binaryString = atob(design.content);
                const contentArray = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    contentArray[i] = binaryString.charCodeAt(i);
                }

                const blob = new Blob([contentArray]);

                const fileReader = new FileReader();
                fileReader.onload = function (event) {
                    const arrayBuffer = event.target.result;
                    const uint8Array = new Uint8Array(arrayBuffer);

                    const detectedType = getImageType(uint8Array);

                    if (detectedType) {
                        const blob = new Blob([contentArray], {type: detectedType.mime});
                        const dataUrl = URL.createObjectURL(blob);

                        previewImage.src = dataUrl;
                        previewImage.width = 300;
                        previewImage.height = 260;

                        cell4.appendChild(previewImage);
                    } else {
                        console.error('Unable to determine image type.');
                    }
                };

                fileReader.readAsArrayBuffer(blob);
            }
        }

        function getImageType(uint8Array) {
            const headerBytes = uint8Array.subarray(0, 4);

            if (headerBytes[0] === 0xFF && headerBytes[1] === 0xD8 && headerBytes[2] === 0xFF && headerBytes[3] === 0xE0) {
                return {mime: 'image/jpeg'};
            }

            if (headerBytes[0] === 0x89 && headerBytes[1] === 0x50 && headerBytes[2] === 0x4E && headerBytes[3] === 0x47) {
                return {mime: 'image/png'};
            }

            if (headerBytes[0] === 0x47 && headerBytes[1] === 0x49 && headerBytes[2] === 0x46 && headerBytes[3] === 0x38) {
                return {mime: 'image/gif'};
            }

            if (headerBytes[0] === 0xFF && headerBytes[1] === 0xD8 && headerBytes[2] === 0xFF && headerBytes[3] === 0xDB) {
                return {mime: 'image/jpeg'};
            }

            if (headerBytes[0] === 0xFF && headerBytes[1] === 0xD8 && headerBytes[2] === 0xFF && headerBytes[3] === 0xE1) {
                return {mime: 'image/jpeg'};
            }

            if (headerBytes[0] === 0x52 && headerBytes[1] === 0x49 && headerBytes[2] === 0x46 && headerBytes[3] === 0x46) {
                return { mime: 'image/webp' };
            }
            return null;
        }

        fetchDesignData(`/Rashu_designs/list/${designer_id}`);


        document.getElementById("nextButton").addEventListener("click", function () {
            if (designs && currentPage < Math.ceil(designs.length / itemsPerPage)) {
                currentPage++;
                displayDesigns(designs, currentPage);
            }
        });

        document.getElementById("prevButton").addEventListener("click", function () {
            if (designs && currentPage > 1) {
                currentPage--;
                displayDesigns(designs, currentPage);
            }
        });

        const designerProfileContainer = document.getElementById("designerProfile");


        const url = `/Rashu_designer/profile?designer_id=${designer_id}`;

        fetch(url, {
            method: 'GET',
            headers: {
                'Accept': 'application/json'
            }
        })
            .then((response) => {
                if (response.status === 200) {
                    return response.json();
                } else {

                    console.error(`Error: Response status ${response.status}`);
                    return Promise.reject('Request failed');
                }
            })
            .then((designerData) => {
                console.log(designerData);

                console.log(designerData);

                // Calculate age from date of birth if it exists
                const dob = designerData.dob ? new Date(designerData.dob) : null;
                const today = new Date();
                const age = dob ? today.getFullYear() - dob.getFullYear() : null;
                const Email =designerData.email || "";
                const ID =designerData.id;
                const Name = designerData.name;
                const Contact = designerData.contact;
                const Bio = designerData.bio;
                const Address = designerData.adds;

                // Build the HTML content
                let htmlContent = `<table style="border:none;"><tr ><td>
                <p style="text-align: left;"><i class="fas fa-user"></i> Name: ${Name}</p>
                <p  style="text-align: left;color:#967d00;
            font-style:italic;"><i class="fas fa-id-card"></i> ID: ${ID}</p>
                <p style="text-align: left;"><i class="fas fa-envelope"></i> Email: ${Email}</p>
                <p style="text-align: left;"><i class="fas fa-phone"></i> Contact: ${Contact}</p>
                <p style="text-align: left;"><i class="fas fa-map-marker-alt"></i> Address: ${Address}</p>
                <p style="text-align: left;"><i class="fas fa-info-circle"></i> Bio: ${Bio}</p>`;

                // Include Date of Birth and Age only if Date of Birth is not null
                if (dob) {
                    htmlContent += `<p style="text-align: left;"><i class="fas fa-calendar-alt"></i> Date of birth: ${designerData.dob} (Age: ${age})</p>`;
                }

                // Complete the HTML content with the profile picture cell
                htmlContent += `</td><td id="profilePicCell"></td></tr></table>`;

                // Set the innerHTML of the container
                designerProfileContainer.innerHTML = htmlContent;

                // Display the profile picture if it exists
                displayProfilePicture(designerData.profilephoto);

            })
            .catch((error) => {

                console.error("Error: " + error);
                designerProfileContainer.innerHTML = '<p>Failed to load admin profile.</p>';
            });


        function displayProfilePicture(base64String) {
            const profilePicCell = document.getElementById("profilePicCell");

            // If profile picture exists
            if (base64String) {
                const profilePicImage = document.createElement("img");

                const binaryString = atob(base64String);
                const contentArray = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    contentArray[i] = binaryString.charCodeAt(i);
                }
                const blob = new Blob([contentArray]);

                const fileReader = new FileReader();
                fileReader.onload = function (event) {
                    const arrayBuffer = event.target.result;
                    const uint8Array = new Uint8Array(arrayBuffer);

                    const detectedType = getImageType(uint8Array);

                    if (detectedType) {
                        const blob = new Blob([contentArray], {type: detectedType.mime});
                        const dataUrl = URL.createObjectURL(blob);

                        profilePicImage.src = dataUrl;
                        profilePicImage.alt = "Designer Profile Picture";
                        profilePicImage.width = 150;
                        profilePicImage.height = 150;

                        profilePicCell.appendChild(profilePicImage);
                    } else {
                        console.error('Unable to determine image type.');
                    }
                };

                fileReader.readAsArrayBuffer(blob);
            } else {
                // If profile picture does not exist, display a Font Awesome icon
                profilePicCell.innerHTML = `<i class="fas fa-user-circle fa-8x"></i>`; // Adjust the icon size as needed
            }
        }

    });

</script>
</body>
</html>
